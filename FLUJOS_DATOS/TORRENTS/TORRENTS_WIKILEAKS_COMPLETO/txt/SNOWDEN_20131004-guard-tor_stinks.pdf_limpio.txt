top secretcomint rel fvey stinks u ctsigdev jun 2012 derived from nsacssm 152 dated 20070108 declassify on 20370101 1 top secretcomint rel fvey top secretcomint rel fvey tor stinksu we will never be able to deanonymize all tor users all the time with manual analysis we can deanonymize very small fraction of tor users however success deanonymizing user in response to topi requeston demand top s ec r etco nt rel fvey 2 top secretcomint rel fvey remation ii joint nsa gchq countertor workshop week one at mhs focus on analytics week two at gchq focus on exploitation httpswikigchqindexphptitleremation top s ec r etco nt rel fvey 3 top secretcomint rel fvey laundry list analytics to deanonymize users circuit reconstruction 21 goes inta goes outtalow latency 2 cookie leakage dumb users epicfail node lifespan 17 dns technical analysisresearch hidden services 4 5 6 7 timing pattern 3 torserversnetamazon aws exploitation quantum attacks 1 20 22 existing options 8 11 shaping 9 16 web server enabling 10 nodes 14 degrade user experience 13 18 nodes baseline our nodes 21 tor node flooding top secretcomint rel fvey top secretcomint rel fvey terrorist with tor client installed tor relay node internet site exit node nj anonymizer cloud current access to very few nodes success rate negligible because all three tor nodes in the circuit have to be in the set of nodes we have access to difficult to combine meaningfully with passive sigint goal expand number of nodes we have access to gchq runs tor nodes under newtons cradle how many other partners partial reconstruction first hops or last hops top secretcomint rel fvey top secretcomint rel fvey analytics goes inta goes outtalow latency find possible alternative accounts for target look for connections to tor from the targets suspected country near time of targets activity current gchq has working version quickant r has alpha tested nsas version nsas version produced obvious candidate selectors goal figure out if quickant works compare methodologies gathering data for additional tests of nsas version consistent random and heavy user top secretcomint rel fvey top secretcomint rel fvey analytics cookie leakage use cookies to identify tor users when they are not using tor current preliminary analysis shows that some cookies survive tor use depends on how target is using tor torbuttontor browser bundle clears out cookies goal test with cookies associated with ct targets idea what if we seeded cookies to target investigate evercookie persistence top s ec r etco nt rel fvey 7 top secretcomint rel fvey analytics cookie leakage tssi doubleclickid seen on tor and nontor ips top s ec r etco nt rel fvey 8 top secretcomint rel fvey analytics dumb users epicfail gchq qfd that looks for tor users when they are not using tor current gchq has working qfd based on hard selector email web forum etc but does not include cookies goal nsa investigating own version great expectations that would include cookies top secretcomint rel fvey top secretcomint rel fvey analytics node lifespan how do i know when particular ip was tor node as opposed to if it was tor node current detection done once an hour by ntoc ronin stores last seen and nodes age off slowly with accurate lifespan goal working with ronin to add more details on node lifespan top secretcomint rel fvey top secretcomint rel fvey analytics dns tssi how does tor handle dns requests are dns requests going through tor does this depend on how the target is using tor current still investigating top s ec r etco nt rel fvey 11 top secretcomint rel fvey technical analysis hidden services tssi what do we know about hidden services current effort by nsa some dsd and gchq work on onionbreath goal harvest and enumerate onion urls identify similar hs based on referrer fields distinguish hs from normal tor clients top s ec r etco nt rel fvey 12 top secretcomint rel fvey technical analysis timing pattern tssi send packets back to the client that are detectable by passive accesses to find client ips for tor users current gchq has research paper and demonstrated capability in the lab goal can we expand to other owned nodes top s ec r etco nt rel fvey 13 technical analysis torserversnet si investigate the amazon aws cloud instances of tor servers how are ips allocated and reassigned once bandwidth limit is reached impact on ronins ability to detect nodes current gchq set up tor nodes on the aws cloud during remation ii top secretcomint rel fvey exploitation quantum quantum to degradedenydisrupt tor access quantumcookie forces clients to divulge stored cookies figure 4 diagram of how the quantum survey cookie technique works top secretcomint rel fvey top secretcomint rel fvey exploitation existing options test current cne techniques fa and shortsheet against torbutton and tbb users current torbutton and tbb prevent cne success possible success against vanilla torvidalia goal modifications to initial cne surveys ignore useragents from torbutton or tbb improve browser fingerprinting using javascript instead of flash top s ec r etco nt rel fvey 16 top secretcomint rel fvey exploitation shaping tssi given cne access to target computer can we shape their traffic to friendly exit nodes route users to separate private tor network stain their traffic or user agent instruct target computer to use service that connects outside tor and reveal true ip current can stain user agent working on shaping top s ec r etco nt rel fvey 17 top secretcomint rel fvey exploitation web server enabling tssi given cne access to web server modify the server to enable timingcounting attack similar to timing pattern idea current gchq has research paper and demonstrated the technique in the lab top s ec r etco nt rel fvey 18 top secretcomint rel fvey exploitation nodes tssi can we exploit nodes probably not legal and technical challenges top s ec r etco nt rel fvey 19 top secretcomint rel fvey exploitation degrade tor experience tssi given cne access to web server make it painful for tor users given cne access to network can we deny degradedisrupt tor users top s ec r etco nt rel fvey 20 nodes baseline our nodes how many nodes do we have cooperative or direct access to can we deploy similar code to these nodes to aid with circuit reconstruction can we do packet timing attacks using nodes can we use the nodes to shape traffic flow can we use the nodes to denydegradedisrupt comms to certain sites top secretcomint rel fvey nodes tor node flooding ov could we set up lot of really slow tor nodes advertised as high bandwidth to degrade the overall stability of the network top s ec r etco nt rel fvey 22 top secretcomint rel fvey tor stinks but it could be worse ssi critical mass of targets use tor scaring them away from tor might be counterproductive we can increase our success rate and provide more client ips for individual tor users will never get 100 but we dont need to provide true ips for every target every time they use tor top secretcomint rel fvey