var http require http repl require repl url require url pg require pg native var db new pgclient tcpcable127601cable dbconnect var createserver function port var server httpcreateserver function request response var data requeston data function chunk data chunk req urlparse requesturl true if reqpathname view cable reqqueryq q select refid origin content date from cable where refid1 dbquery q cable function error result var json jsonstringify resultrows responsewritehead 200 contenttype textplain charsetutf8 contentlength jsonlength responseend json else search reqqueryq if search responsewritehead 501 contenttype textplain charsetutf8 return responseend jsonstringify error you must supply search term q select refid origin ts_headlineenglish content plainto_tsquery1 as content from search left outer join cable on cableid searchdocument_id where document plainto_tsquery1 limit 10 query dbquery q search function error result var json jsonstringify resultrows responsewritehead 200 contenttype textplain charsetutf8 contentlength jsonlength responseend json if port serverlisten port return server createserver 3000 ctx replstartcontext