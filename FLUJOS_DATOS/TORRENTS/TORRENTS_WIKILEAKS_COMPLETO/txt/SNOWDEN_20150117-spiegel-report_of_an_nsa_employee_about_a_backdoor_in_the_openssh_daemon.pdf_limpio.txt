snips of sigint u monthly notes for june 2012 dynamic page system m x _ _ c r tj_ s i t l n t keyhole re l to usa fvey top secretsirel to usa fvey snips of sigint u monthly notes for june 2012 1 of 5 snips of sigint u monthly notes for june 2012 top s c r t s i r l to usa f v f ivi vi i li 11 i vuico lui uui ic tj i 20120627 0358 pm entry tags monthly notes technical accomplishments ufouo pitied fool tssirel pitiedfool is suite of cna tools im developing for use against file systems initially focused on windows more information can be found on the dsd wiki but its bit ugly at this point tssirel determined that it was combination of the volume shadow copy and deleted entries in the shadow copy that were causing my recovery woes as result of the shadow copy having large chunks of mft data in it and much of these records still being mostly correct recovery programs were able to reconstruct most of the system drive i added functionality to pitiedfool to overwrite the contents of the shadow copy on each partition encountered tssirel now that i was overwriting large chunks of data for every partition i could longer ignore the performance issues with writing to disk one sector at time i refactored my code to overwrite in blocks configurable by preprocessor definition and sped up execution about 15fold with the possiblity of it going even faster with increased memory usage tssirel after all this i tested pitiedfool within fuzzyebola and it worked flawlessly i took build of fuzzyebola from last month and without recompiling inserted the pitiedfool binary with configuration details to execute it at certain time at that time i saw the process usage slightly increase from 0 to around 2 and few minutes later the system rebooted and didnt come back up running file recovery tool over the entire drive yielded some files from scraping headers but nearly the entire contents of the drive were irrecoverable and if it had been configured to securely wipe every sector on the drive after killing the mft and vss it wouldnt have been able to recover anything at all success u fouo documented my work ufouo pant sparty tssirel pant sparty is backdoor in the ssh daemon for nix based on openssh portable it allows public key to be embedded in the sshd binary and will then always grant root login shell if presented with the proper key pair for that key in other words it behaves as if the given key is in sshauthorized_keys tssirel currently dsd uses authorized_keys as quickandeasy method of persistence against certain nix targets in most cases this 2 of 5 snips of sigint u monthly notes for june 2012 works but it obviously isnt very stealthy and can run into problems if that file is deleted or the ssh configuration changes to not use it the goal for this project was to provide the same level of persistence but embedded in the sshd binary itself obviously assuming root access as before tssirel by adding my own check in several key places within the ssh code i was able to grant authorization to key embedded in the binary without too much trouble the hard part came in granting that user root privileges even if the configuration specifically banned root login that was achieved by setting flag in the authorization context within the server that essentially said this is our backdoor let it happen oh and stop logging also tssirel then i wanted to have it so if you provide normal username as login it still grants you root shell ssh has lot of checks to make sure you cant switch usernames in the middle of login go figure so this was bit tricky to bypass ultimately i was able to use the same flag as the previous step and just had to put checks for it in other places tssirel more fun was to be had when i wanted to allow an arbitrary username to be provided ie one that doesnt exist on the system while still allowing for root login this led to all sorts of problems where i didnt even get valid authorization context at all and i couldnt manually call the c function to get one for root because the connection is deprivileged child process so i had to forcefeed it fake one for root of course the forcefed hash for root doesnt match the entry in passwd so i had to throw in another check there to return true if its the backdoor and theres all sorts of fun happening with preauth where 1 had to revert the authorization context back to its original value to postpone its processing standard authorization step in some cases and then properly update it to root during the actual authorization step later on once i got this working however user is able to run ssh abcdefgtarget and the targets logs only show invalid username abcdefg without the followon message of accepted publickey for root from 10001 port 55000 ssh2 presenting valid username leads to the only logged output being that the public key check failed ssirel i set my new implant development pr on this project my previous record was 3 days for dirtydeeds but i finished this in 2 technically i had it working in day but it wasnt what i considered releasable so ill have to wait for some other opportunity to present itself so i can achieve the feat of an implantinaday awardsrecognition ufouo letter of appreciation froml director dsd 3 of 5 snips of sigint u monthly notes for june 2012 ufouo letter of appreciation from chief susloc ufouo susloc coin briefings and demonstrations given srel briefed the us ambassador to australia on my work on cnacne and collaboration with tao during my time at dsd meetings and briefings attended u nstr u weekly susloc meetings reportspaperspublications u nstr training u nstr miscellaneous u new zealand was incredible i wish id had more time there but i think i did pretty well i saw handful of lotr sights mount cook number of gorgeous lakes snowcapped mountains everywhere if you want pictures let know and ill shoot you the link u tasmania was similarly awesome and not just because i can now say yea ive been to tasmania because you know it sounds cool at the us embassy independence day party ufouo my time at dsd came to close in june as my flight back is on 30 june 26 hours in an airplane woo i absolutely loved my time in australia both in terms of work and travel but im also looking forward to returning to the land of chickfila college athletics bbq pork and real bacon oh and good beer u the bcs is dead yessssssssssssssssssssssssssssssssssssss ssssssssssssssssssssssssssssssssssssssss 4 of 5 snips of sigint u monthly notes for june 2012 ssssssssssssssssssssssssssssssssssssssss sssssssssssssssssssssssssssssssss leave comment page publisher 1314 end user solutions derived from nsacssm 152 dated 08 jan 20 07 declassify on 20320108 dili i_c_ page system max _ c r t s_i_ t l n t keyholerel to usa fvey portion max top secretsirel to usa fvey 5 of 5