uk top secret strap1 comint potential technique to deanonymise users of the tor network opcmcr gchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint outline tor and the need for deanonymisation data transformation scoring results current status software igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint what is tor the onion router hides source of traffic by passing encrypted versions of your internet traffic between multiple tor routers notation client the initiator of communication guard node the tor router the client contacts exit node the tor router that relays your traffic to the final destination with extra encryption so this link can be exploited by sigint system g c h q this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq crown copyright all rights reserved onion router onion router onion router onion router client server uk top secret strap1 comint what is tor guard node onion t router exit node g c h q this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq or crown copyright all rights reserved uk top secret strap1 comint who uses tor tor was created by the us government and is now maintained by the electronic frontier foundation eff eff will tell you there are many pseudolegitimate uses for tor were interested as bad people use tor in particular terrorists paedophiles igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq or crown copyright all rights reserved uk top secret strap1 comint aim find client ip address associated with tor exit node traffic attack based on externals specifically packet timings strong crypt is being used igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint aim well make our task easier by assuming we own the exit node being used allows us to see all the traffic associated with tor circuit demultiplex traffic by unknown user f this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on igchq crown copyright all rights reserved uk top secret strap1 comint side note circuit tracing one suggestion was to track packets through each hop in the tor network we experimented with spotting all links in circuits created by gchq visibility was too low to be sensible approach 13 out of 8294 potential intertorrouter links were seen we will directly correlate exit node traffic and traffic between client and guard node igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint own igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint test data collection used the standard tor button webbrowser package to access tor made minor changes to ensure we could collect exit node traffic 1 news search for news visit news websites 2 tor browse the tor website and then use privacy checking website split into 2a and 2b as tor changed circuit midway through 1 download visit to slashdot followed by downloading large pdf file 2 forum search on google followed by browsing pc technical help forum igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint flattening of timing patterns ictrne observed that tor can flatten out timing patterns tor uses ratelimiting storeandforward procedure at each tor router graph shows bytes of exit node traffic in green and client traffic in red whilst downloading 1mb file figure from 5qq00 250qq t t 50 100s 15ds 200s f this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on igchq crown copyright all rights reserved uk top secret strap1 comint cumulative packet counts our new insight is to use cumulative packet counts hope packets are approximately preserved approximate as tor repacketises data see strong correlation exit guard l r stoc t 1 1 1 1 1 1546 1548 1550 1552 1554 1556 1546 1548 1550 1552 1554 1556 1622 1624 1626 1628 1522 time hhmm 1524 1 r 1626 162b g c h q oi this information is exempt from disclosure under the freedom of inforn other uk information legislation refer disclosure requests to gchq or crown copyright all rights reserved uk top secret strap1 comint scoring basic idea an idea of bin time into intervals for each interval get pair g cumulative exit node packets upto time i cumulative guard node packets upto time i measure the correlation between these pairs we use is timewindows easy for the sigi nt system seems to work g c h q this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint scoring refinements we also expect counts to be similar fit linear model gi apei only accept sessions where v2 52 igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint scoring refinements there may be an unknown timeoffset traffic takes time to relay through the tor network sigint clocks may not be synchronised we slide the traces against each other and find the best match truncate to exit node trace we know that it is complete tor circuit this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on g c h q crown copyright all rights reserved uk top secret strap1 comint selfcomparison beta we show how the score behaviour as function of time slide see high correlation pink at small time offset also generally see 3 blue in sensible range 20 15 10 05 20 15 10 05 00 20 15 10 05 h 00 r2 500 500 ctos 1 stoc 1 ctos 2a stoc 2a 1 il 1 1 ft ctos 2b stoc 2b ctos 3 stoc 3 ctos 4 stoc 4 x 500 500 time offset s igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint false positives want an algorithm with very low false positive rate used 2 hours of timestamp source ip destination ip tuples captured from 4 10g internet bearers filtered to tuples between guard node and non tor node allow time to arbitrarily slide 2 hours in real redeployment one would restrict this slide allow us to plot roc curves for the technique igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret straf false positives linear log roc curve plot servertoclient good we miss the very short 2a session with falsepositives threshold r20998 high as comparing increasing functions clienttoserver direction many false positives theres less structure in data as less data flows in this direction when webbrowsing server to client i v cl d oo ö co cn ö ö n 1e06 i i 1e04 1e02 false positive rate client to server 1e00 jd œ i 7 cl où ó ö ö m ö ö igchq this information is exempt from disclosure under the freedom of infoi other uk information legislation refer disclosure requests to gchq c crown copyright all rights reserved 1e06 1e04 1e02 false positive rate 1e00 uk top secret strap1 comint larger experiment we want to find some false hits to understand worst case accuracy for the servertoclient direction lets open the aperture very wide 2027 bearer hours of logs with any time slide filter to all traffic involving tor node not just likely guardtoclient traffic as before we find some false hits 540 but rate is assessed to be low enough 92 of false hits are against the big download session which has little structure igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint the next step we are collecting the required logs of packet times with tor guard nodes in sigint gte jtrig have adapted some tor exit nodes we own to collect the required exit node data we are keen to engage with others with exit nodes too then run the attack expect to basically work some extra work might be required to only allow queries on sessions with enough structure need the bulk data first to progress this question this information is exempt from disclosure under the freedom of lnformatiorwçoojtçht other uk information legislation refer disclosure requests to gchq igchq crown copyright all rights reserved uk top secret strap1 comint r package an r packaae can be downloaded from includes algorithm and the collected webbrowsing data recommend r packages for sharing analytics can contain r c fortran code example data runnable examples and documentation unit tests g c h q this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint conclusion have shown potential externalsbased deanonymisation attack for tor requires sigint collection of guardtoclient packet times requires tor collection from exit nodes we own hope to get this running live at gchq soon full paper and software available from igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved uk top secret strap1 comint igchq this information is exempt from disclosure under the freedom of information act 2000 and may be subject to exemption under other uk information legislation refer disclosure requests to gchq on crown copyright all rights reserved