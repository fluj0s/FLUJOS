user guide for cofee v112 release date september 2009 copyright reserved ii table of contents introduction 1 what is cofee 2 digital forensics attributes and principles 2 volatile information collected 2 why use cofee 3 who should use cofee 3 how to use cofee 3 tool generation phase 4 data acquisition phase 4 report generation phase 5 installation 6 prerequisites 7 investigator machine 7 usb removable device 7 target machine 7 installation steps 8 installation troubleshooting 14 operation instructions for device generation 15 program startup 16 gui interface 16 format device 17 generating cofee thumb drive 18 tool generation 18 case notes 19 usb generation steps 19 advanced operations 20 output usb 20 more options advanced 20 usb generation troubleshooting 25 format troubleshooting 25 iii generation troubleshooting 26 operation instructions for the cofee usb device 27 beginning the cofee process 28 with autorun enabled 28 without autorun enabled 28 removing the usb device 30 generating report of the collected data 31 create report from the collected data 32 interpretation of reports 34 menu navigation 35 report troubleshooting 38 appendix 39 nw3c volatile data profile 40 programs arguments 40 nw3c incident response profile 41 programs arguments 41 cofee version change log 43 this project was supported by grant 2008cecx0001 awarded by the bureau of justice assistance the bureau of justice assistance is component of the office of justice programs which also includes the bureau of justice statistics the national institute of justice the of fice of juvenile justice and delinquency prevention and the office for victims of crime points of view or opinions in this document are those of the author and do not represent the official position or policies of the united states department of justice 1 introduction 2 what is cofee cofee consists of three major components the gui interface for the investigator the command line application to be executed on the target machine and the individual tools which are managed by cofee and the command line application there are two major types of live forensics investigation tools live information acquisition tools and remote online acquisition tools computer online forensic evidence extractor cofee is live information and volatile data forensics acquisition system the gui interface was developed for managing the tool selection generating scripts loading programs onto usb device and creating report from the collected data the command line application was developed for controlling and executing set of selected tools on the target machine digital forensics attributes and principles in any digital forensics investigation digital forensics specialists and legal advisors should ensure the balance between the three main attributes reconnaissance relevancy and reliability of the digital evidence in any digital forensics investigation the investigator should always attempt to achieve the maximum amount of data acquisition while having minimal effect on the integrity or accuracy of the data when applying reconnaissance relevancy and reliability to the live forensics investigation environment it is paramount that any investigative tool used should operate in the least intrusive way it is also vital that all operations conducted on target machine be documented to the best extent possible this aids in the reliability of the collected data as well as the integrity of the target machine great effort was taken to ensure that the cofee execution process leaves the smallest footprint possible on the target machine volatile information collected the specific information collected by cofee varies depending upon which profile is selected however the type of volatile information collected includes date and time open network connections and additional network related information user account information including the currently loggedon user current processes and services open files and registry information 3 why use cofee in cofee the gui interface is used for the preparation of the forensics tools and the assigning of the digital forensics execution order according to live forensics guidelines investigators should take into account the order of evidence volatility while having minimal interaction with the target machine cofee has been designed to provide the investigator the ability to collect evidence from target system with the minimum of user interaction after the gui interface generates cofee usb device copies all scripts and programs the investigator can take the device and easily insert it onto target machine and begin the collection process by executing single program while specific programs have been selected as part of the included profiles cofee allows seasoned investigator to add or remove any program they desire as well as create any profile to meet their specific investigative needs who should use cofee cofee was designed to meet the needs of two distinct classes of users the forensic examiner and the frontline investigator the gui console which allows the user to create profiles and generate cofee usb devices was designed to be operated by computer forensic examiner the creation of profiles requires that the user have firm understanding of the tools to be executed and the reason behind their inclusion within the profile the command line application however requires minimal training because the scripting process has already been designed by forensic examiner this allows any frontline investigator to use this tool and collect data once the data is collected the usb device should be returned to the forensic examiner for analysis how to use cofee the cofee execution process is divided into three phases tool generation data acquisition and report generation 4 tool generation phase digital forensics specialists have the ability to select desired tools to run against target machine based on the individual case requirements this can be done by either selecting predefined profile or by manually creating profile and selecting which tools including switches are to be run against the target machine data acquisition phase after generation of the cofee device investigators can take the usb device and insert it into the target machine execution of cofee on the suspect machine will then complete and all collected data will be stored on the usb device 5 report generation phase after the collection of the volatile information from the target machine investigators can load that information back into the gui console on the investigators machine and generate report based upon the data 6 installation 7 prerequisites before installing cofee v112 please refer to the following hardware and software requirements for the investigator machine usb removable device and the target machine investigator machine hardware pentium 4 or above 512 mb ram usb 11 or higher 50mb free hard drive space software windows xp or above net framework 35 or higher usb removable device hardware minimum 1gb device recommended 2gb or larger file system fat32 file system is recommended target machine hardware usb port enabled software windows xp windows xp is currently the only supported operating system it is possible that cofee will work on additional operating systems but these operating systems have not been tested and are not supported 8 installation steps step 1 execute the installation program cofee v112 installermsi step 2 setup wizard is displayed click next to continue 9 step 3 the cofee license agreement is displayed read the agreement carefully select i agree and click next to continue 10 step 4 select the folder in which to install cofee by default the programs will be installed to cprogram filescofee v11 the disk cost button will display the amount of space the cofee installation will take up on the investigators computer based upon the installation folder selected after selecting the installation folder click next to continue 11 step 5 click next to continue 12 step 6 wait for the installation to finish 13 step 7 installation complete click close to exit cofee will install shortcut on the investigators desktop as well as create program group under the start menu either can be used to start cofee 14 installation troubleshooting if during the installation process the following screen appears the system does not currently have the required version of the net framework cofee v112 requires net 35 which can be downloaded from microsoft to upgrade click yes this will require working internet connection clicking yes will open web browser and navigate to microsoft webpage which contains the installation for the most recent version of the net framework click the install button and follow the installation instructions once the net framework is installed try the cofee installation again 15 operation instructions for device generation 16 program startup the first step to running cofee is to connect the usb device into the investigators machine and ensure that windows has properly recognized the drive prior to launching cofee after the drive has been recognized launch cofee gui interface tool generation gui 1 menu system file menu i format device allows the user to format and wipe usb device as fat32 ii exit closes cofee b help menu i log will display the cofee log file ii about displays the about screen 2 tab selection i tool tab used to generate cofee thumb drive ii report tab used to create report from collected data will be discussed in different section 17 3 tool generation set the options for device generation 4 case notes allows the investigator to enter information about the case that will appear in the final report 5 generate this button will generate the thumb drive based upon the options selected 6 message box this section displays information about current cofee processes format device the menu option format device will open new window which will allow the user to format and wipe any attached device cofee will format the selected device as fat32 and will only allow devices 1gb or larger to be formatted or wiped if the device is between 1gb 2gb cofee will display message reminding the user that the recommended device size for cofee is 2gb or larger step 1 select the device to format from the drop down box step 2 check the box wipe and format drive to wipe the device as well as format skip this step if only format is desired 18 step 3 click the button to proceed the button text will vary depending on whether the user is only formatting or conducting wipe as well click format if only format is required click format and wipe to format and wipe the device generating cofee thumb drive the primary purpose of cofee is to generate thumb drive which runs predetermined set of programs that collects valuable data from suspects machine tool generation below is listing of the fields in the tool generation section of cofee see section 3 of the tool generation gui screenshot 1 cofee source this section is automatically filledin during the installation process 2 cofee usb this section allows the user to select which device becomes the cofee device ie select the device to send the cofee usb files to 3 output usb this is an advanced option which allows the user to select second device for the storage of the saved data this option is not recommended 4 mode the profile used to generate the usb device profile contains listing of programs and switches that will be copied to the thumb drive which will then be run against the suspects machine 5 more options advanced an advanced option which allows users to modify or create their own profiles 19 this section requires the user to have thorough knowledge of the programs and their switches if any switch or program is added incorrectly it can severely damage the suspects machine as well as the integrity of any evidence collected 6 usb label allows the user to select the volume label of the generated thumb drive the default label is cofee 7 checksum inforefresh whenever new tool is added to profile this button needs to be clicked so that cofee can obtain checksum value of that file during the generation process cofee automatically uses the checksum values to ensure the proper files are copied to the usb device case notes this section contains five fields which can be filled in by the investigator see section 4 of the tool generation gui screenshot none of these items are mandatory however the contents of these fields whether filled in or not will appear in the final report the user has the option of entering 1 case type 2 case id 3 console operator 4 usb operator 5 case description usb generation steps the following are the recommended steps necessary to create cofee usb device assuming that the user has already connected the desired usb device and that windows has finished recognizing it and has already launched cofee step 1 if necessary formatwipe the usb device step 2 select the usb device under the cofee usb drop down box step 3 leave the output box unchecked step 4 select the desired profile from the mode drop down box step 5 enter any relevant case note information step 6 click generate after all items have been transferred to the usb device message which says done will appear the generation process is then complete 20 advanced operations output usb the output usb option allows user to decouple the location to which the cofee programs the programs that are copied when usb device is generated and the acquired data are stored to separate the locations check the output usb option and select different device for the storage of the acquired data however it is highly recommended that the same device be used for both the storage of the cofee programs as well as the acquired data more options advanced the more options advanced button allows user to create andor modify nondefault profiles cofee comes with two default profiles nw3c incident response and nw3c volatile data to create or modify profile follow these steps step 1 select profile to use as base template in the mode dropdown list see section 3 of the tool generation gui screenshot step 2 click the more options advanced button and the following screen will appear the tool selection screen 21 the tool selection screen consists of two primary lists of files applications list and running sequence the running sequence is the profile the applications with switches listed here are the programs that will run as part of the profile and will run in that particular order the applications list consists of all applications and switches which have been entered into cofee typically as part of previous profile creation each item in the list consists of combination of one application and its switches program may also be entered without switch single application may be listed multiple times if each instance uses different switch or combination of switches for example in the screenshot above netexe is listed in the profile five times but each time with different switch any one item from the application list can only be added once to the running sequence if that item already exists in the running sequence it will be grayed out in the application list and will not allow it to be copied again applications list menu if the user rightclicks on an item within the applications list the following menu appears 1 remove this will remove the selected item from the application list 2 sort by command sorts the items in the application list 3 grouping items are displayed by application name 4 group by family organizes programs by family 5 group by selection groups by available or already selected for the current profile 6 property displays the property screen for that entry adding predefined programs to running sequence adding predefined program including predefined switches to the running sequence is simple process step 1 select the desired tool in the application list step 2 click the single right arrow this adds the selected item to the running sequence 22 the user can also choose to add all of the available programs into the running sequence by clicking on the double right arrow removing programs from running sequence removing predefined program from the running sequence is done in the opposite way that pre defined application is added step 1 select the desired tool in the running sequence step 2 click the single left arrow this removes the selected item from the running sequence the user can also choose to remove all of the programs from the running sequence by clicking on the double left arrow adding new tool or new switch to the application list instances will arise when an investigator will wish to use either tool which was not included with cofee or use switch which did not come predefined by cofee the process for either of these options is the same step 1 click add tool see the tool selection screen screenshot the following screen appears 23 step 2 enter description for the tool this description will show up in the final report and is designed to state the purpose of the application step 3 select the tool step 3a if the tool is independent ensure that the use the same tool for all option is checked and then click on the top browse button in line with xp standard file location dialog box will open find and select the tool then click ok this will populate all three boxes of the tool section step 3b if the tool isnt independent yet there is version of the software available for each eg netstatexe the user has the option of using separate program for windows xp 2000 and 2003 when the programs are run as part of the cofee process the program will determine what is currently running and use the appropriate file to do this ensure that the use the same tool for all option is unchecked and then load the file for each by clicking on its corresponding browse button if the application is unavailable for any of the listed oss uncheck that particular box xp 2000 2003 step 4 enter all of the desired switches for the program the user can leave this box empty if arguments are used step 5 select the family for which this program will belong the family represents the purpose of the tool and is used by cofee to organize the acquired data for example the program netstatexe belongs to the family network while the program quserexe belongs to the family users the family options are network process services users password policy registry log file memory opt_tool and misc step 6 select the output format extension of the tool this affects the output format of the tool for example the option text expects the output of the program to be text the complete list of available output formats are text image directory and memory dump step 7 the information entered in the vendor name and vendor link fields will be listed in the final report step 8 enter any additional required files for example some programs require specific dynamic linked library dll files to be included for the program to run properly this section tells cofee what other programs to put on the usb device other than the selected program step 9 ensure that randomizing tool name is checked this ensures that the programs copied to the usb device have unique file name minimizing any possibility of running program from the suspects machine step 10 click ok 24 if any new programs are added ensure that the checksuminfo refresh button is clicked when returning to the main cofee gui screen if new checksum isnt created the process will create an error when trying to generate usb device saving modified profile an investigator may want different sets of profiles for different scenarios after the configuration of new running sequence cofee provides the ability for user to save the new profile step 1 click save order button on the main tool selection screen see tool selection screen screenshot and the following screen appears step 2 in the save as section type the name of the new profile step 3 click accept loading profile to modify by default the more options window will load whichever profile is selected on the main window however the user has the option to load different profile to work on by clicking the load order button and selecting which profile they wish to modify or view 25 usb generation troubleshooting format troubleshooting 1 if the following screen appears this indicates that the drive is under the required size and will not let the user continue to correct this problem use larger usb device 2 if the following screen appears this indicates that the drive is between 1gb and 2gb this warning indicates that the drive is below the recommended size however cofee will allow the user to continue 3 this following error most often occurs if the user has the device open eg open in windows explorer the drive to be formatted cannot be open nor can any file on the device be open for format to properly occur ensure that they are all closed and try again 26 4 an error similar to that displayed in item 3 above will occur if the user attempts to format the device prior to windows completing the driver installation for that device generation troubleshooting message box stating interrupted appears this indicates that some process during the generation of the usb device failed and needs to be remedied to determine the exact error look at the text in the white message box see section 6 of the tool generation gui screenshot on the cofee main screen checksum mismatch this most commonly occurs when new or updated program file is added by user this problem is easily remedied by clicking on the checksum info refresh button after this process completes the user can go through the generation process again the following example indicates that there was checksum error with the file ipconfigexe the checksum of following files does not match cprogram filescofee v11binwin2kipconfigexe generation is stopped due to hash mismatch please verify or remove above problem files if validated click refresh checksum 27 operation instructions for the cofee usb device 28 beginning the cofee process similar to running on the investigators machine the first step to running the cofee usb device is to connect the usb device into the suspects machine and ensure that windows has properly recognized the drive once the device is connected there are two possible methods for executing the cofee process if autorun is enabled on the suspect machine or if it isnt both methods are described below with autorun enabled if autorun is enabled the following screen will appear after windows has finished recognizing the usb device to begin the cofee process ensure the option execute runnerexe is selected and click ok without autorun enabled if the above screen does not appear then it is likely that autorun is not enabled on the suspects machine to begin the cofee process follow the steps below step 1 open my computer this can be done by either opening the icon on the suspects desktop or by selecting start and then my computer step 2 select and open the cofee usb device the device can easily be identified by both the volume label as well as the icon associated with the drive in the following example the drive is the cofee usb device 29 step 3 find and execute the file runnerexe at this point the cofee process has begun 30 removing the usb device while the cofee process is running window similar to that below will be displayed when the window closes the process has completed when the process is complete follow standard procedures to safely remove the device at this point all information has been captured and the usb device can be returned for report generation and analysis note for individuals who would like further verification that the process has properly completed the investigator at the scene can view the cofeelog file which is located in the data storage directory see generating report of the collected data for more information concerning the data storage directory the final item in the log file should be end 31 generating report of the collected data 32 create report from the collected data once the data has been acquired from the suspects machine an htmlbased report can be generated of the collected data to begin the process click on the report tab on cofees main screen step 1 connect the usb drive to the investigators computer step 2 select an input folder click the browse button under raw input folder and select the acquired datas output folder the standard convention will have the data stored on the usb device under the following folder outcomputer nameyymmddhhmmss eg outadministrator 2009092110213 the computer name will be the computer name of the suspect machine while the datetime will be when the cofee process started on the suspect machine step 3 select an output folder click the browse button under output folder and select the desired folder in which to generate the report the user can also create folder in the browse screen 33 step 4 fill in any case notes these fields are optional and will appear in the final report step 5 click generate step 6 when the report is finished generating cofee will ask if the user wants to open the target folder at this point the report is generated clicking yes will direct the user to the folder containing the report if the user clicks the report can still be found in the folder identified in step 3 step 7 open the indexhtml file to view the report 34 interpretation of reports the cofee report is generated in an xml format and is displayable in all major web browsers eg internet explorer and firefox the report is generated in two frames the left frame contains navigational menu to view the report while the right contains the actual report data screenshot of sample report 35 menu navigation menu folders the cofee navigation frame left is divided into 14 sections there is one folder for each of the 12 families network process services users password policy registry log file memory opt_tool and misc these folders contain the results of any file that was designated as part of that particular family the main folder contains the cofee log file which is generated when the process is run on the suspect machine and any case notes which were entered either during the usb device generation or during the report generation the correlation folder contains up to three reports that are generated based upon what programs are run lsof services_correlation and processes_correlation 1 lsof list opened files with network connection shows the process port number and open files correlation the information collected comes from the following programs pslistexe openportsexe netstat and handleexe if none of these programs are run this report will not be displayed if only portion of the files are run this report will be based on only the programs that ran 2 services_correlation correlate different commands among services this report displays the services as reported by different programs the following programs are used by this report dumpsecexe computercomputername rptservices saveastsv outfileoutfile psserviceexe sclistexe and scexe query this report will list services which were reported by the programs with check mark or an x indicating whether particular tool reported specific service like the other correlation reports only those programs which were actually run will show up in this report of the programs listed above services_correlation screenshot 36 3 processes_correlation correlate commands among processes similar to the services correlation report but correlates running processes versus services the programs used to generate the report are pslistexe tasklistexe svc cmdlineexe and pstatexe processes_correlation screenshot program reports each program run has its own report within the full cofee report if the program name is highlighted in blue then cofee was able to obtain valid output from that program if the program name is highlighted in gray then there was likely an error in collection and there is collected data for that particular file for example in the listing on the left netexe view valid data was collected and is in the report netexe session data was collected due to an error 37 each report has the following sections 1 description displays listing of the program run and the description of that particular program 2 hash matching result hash of all of the stored data is created and compared to the hash which was created when the data was originally collected this section displays to the reader whether the two hash values matched if the values do not match this could indicate that someone has modified that particular output file 3 start time the time the program started on the suspect machine 4 end time the time the program ended on the suspect machine 5 output this contains the stored output of that program if an error occurred sixth section will be displayed 6 error displays what error occurred when the program attempted to run eg access denied 38 report troubleshooting often javascript warning will display when attempting to view the report in internet explorer to correct this problem 1 rightclick on the warning bar 2 select allow blocked content 3 click yes 4 the report should reload with problems 39 appendix 40 nw3c volatile data profile the nw3c volatile data profile was developed to allow an investigator to collect potentially important volatile data prior to seizing machine for full forensic examination this profile was designed so that none of the programs run causes any direct writes to the suspects file system programs arguments application argument description ipconfigexe all list network configuration nbtstatexe n lists local netbios names netexe user displays users on the computer andor domain netexe file display opened shared files on the server netexe accounts adjust account settings displays info such as password age minimum length lockout threshold etc netexe share local network shares netexe use connects or disconnects your computer from shared resource or displays information about your connections pslistexe t displays process tree pslistexe process information lister whoamiexe displays the user the system is currently logged in as quserexe displays information about users logged onto the system psloggedonexe logon session displayer netstatexe ao displays protocol statistics and current tcpip network connections displays all connections and listening ports and the owning process id associated with each connection netstatexe displays protocol statistics and current tcpip network connections displays addresses and port numbers in numerical form and the owning process id associated with each connection sclistexe displays service list for local machine showgrpsexe displays groups that users are members of systeminfoexe displays operating system configuration information for local or remote machine including service pack levels 41 nw3c incident response profile the nw3c incident response profile was designed for incident response investigations in which the investigator is not able to perform forensic analysis on the target machine this profile was designed to have minimal impact on the suspects file system programs arguments program arguments description arpexe displays current arp entries by interrogating the current protocol data if inet_addr is specified the ip and physical addresses for only the specified computer are displayed if more than one network interface uses arp entries for each arp table are displayed atexe lists scheduled events autorunscexe displays programs scheduled to autorun during boot getmacexe displays mac address handleexe ever wondered which program has particular file or directory open handle is targeted at searching for open file references dump information about all types of handles not just those that refer to files other types include ports registry keys synchronization primitives threads and processes hostnameexe list hostcomputer name ipconfigexe all shows detailed ipconfig information msinfo32exe report outfile will create report of msinfo32 essentially system information nbtstatexe n lists local netbios names nbtstatexe 127001 lists the remote machines name table given its ip address local host netbios over tcpip nbtstatexe s lists session table with the destination ip netbios over tcpip nbtstatexe c lists nbts cache of remote machine names and their ips netbios over tcpip netexe share local network shares netexe use connects or disconnects your computer from shared resource or displays information about your connections netexe file display opened shared files on the server netexe user displays users on the computer andor domain netexe accounts adjust account settings displays info such as password age minimum length lockout threshold etc netexe view displays list of computers in specified workgroup or the shared resources available on specified computer netexe start start the specified network service will list started services 42 netexe session display all sessions connected to the computer and deletes them if specified netexe localgroup administrators domain lists members of administrators group for the domain error printed if domain exists netexe localgroup displays list of group aliases for system eg guests administrators power users etc netexe localgroup administrators lists members of the administrators group netexe group add delete view and otherwise manage network workgroups netdomexe query dc only works with domain controller put in the dc spot netstatexe ao displays protocol statistics and current tcpip network connections displays all connections and listening ports and the owning process id associated with each connection netstatexe displays protocol statistics and current tcpip network connections displays addresses and port numbers in numerical form and the owning process id associated with each connection openfilesexe queryv lists files and folders that have been remotely opened on the system must have admin privileges psfileexe local and remote network file lister pslistexe process information lister pslistexe t displays process tree psloggedonexe logon session displayer psserviceexe lists services on local or remote system pstatexe pstatexe is resource kit utility that provides information about the processes and drivers that are currently running on your computer for diagnostic purposes the most useful information is the list of loaded drivers at the end of the output psuptimeexe displays the systems current up time quserexe displays information about users logged onto the system routeexe print displays routing information scexe query queries the status for service or enumerates the status for types of service scexe queryex queries the extended status for service or enumerates the status for types of service sclistexe displays service list for local machine showgrpsexe displays groups that users are members of srvcheck 127001 check server information tasklistexe svc displays services hosted on each process whoamiexe displays the user the system is currently logged in as 43 cofee version change log version 11 nw3c updates to original cofee includes removal of fciv and pipe as well as modification of formatwipe and the creation of nw3c profiles sha1 hashing utility created and implemented to replace fciv quick fat32 format utility created to replace formatwipe issues modified cofee to use cipher to wipe unallocated area of the thumb drive version 111 modified the wipe portion wipe now formats then wipes with sdelete with the c argument and then formats again modified source code to remove cipher and replace with sdelete option to overwrite unallocated area of thumb drive with one pass of zeroes version 112 fixed bug which would not allow drives with drive labels to be formatted or wiped