dnclassified fodo copyright u utjjty of security conferences s us hide _ 20120208 0953 am do not reuse image uf0u0 caveat its been couple years since i have attended security conferenceshmoocondefconblackhat my opinions are not formed from recent firsthand experience but through previous stimuli to my cerebrum that have been confirmed by 2nd hand experience over the last couple of years when i first went to blackhatdefcon it was with the wideeyed anticipation of im going to go listen to all of the talks that i can soak up all of the information possible and become supar1337haxxor what letdown of an experience that was you find the most interesting topics and briefings wait in lines to get seat and find yourself straining your ears to listen to someone that has basically nothing new to say most of the talks get hyped up exponentially past any amount of substance they actually provide most of the interactive sessions end up in oh woe is the state of the security industry chant and leave the audience better off than before ufouo if you want to learn crazy new things more often than not you wont find it at talk in why not walk around nsa find people in offices that do things you find interesting and talk to them about how they do what they door find mentor in that area despite stereotypes of the kinds of people that work here many people are kind and open enough to share their tradecraft with others we have the luxury of working in community that has some of the brightest smartest and most cutting edge people around it would be shame for people to constantly attend cons hoping to learn that cool new thing when there is exponentially more knowledge sitting around them every single day at work ufouo granted there are always couple exceptional talks at the cons but in my humble opinion they dont make up for the overall lack of content so what good are these conferences my personal opinion is that their utility is mainly for social interaction and meeting relatively likeminded individuals its the ability to kick back for weekend and geekout with other people for some this makes the cost of the completely worth it others may be severely disappointedit all depends on what you expect to get out of it current moodcokay leave comment secretsirel to usa pvey copyright u hunt sgnts part qsp1 hide _ 20121212 1010 am do not reuse image ssirel so sigint is down right cool as much as we complain about our big data problem collectionprocessing issues dismal infrastructureoutdated browsersoss our ability to pull bits out of random places of the internet bring them back to the motherbase to evaluate and build intelligence off of is just plain awesome ssirel one of the coolest things about it is how much data we have at our fingertips if we only collected the data we knew we wantedyeah wed fill some of our requirements but this is whole world of possibilities wed be missing it would be like going on roadtrip but wearing blindfold the entire time and only removing it when youre at one of your destinationsyeah youll still see stuff but youll be missing out on the entire journey ssirel so i decided to write short series affectionately titled 7 hunt on things that im trying to do with data that wouldnt normally be interesting by itself but by thinking about it in new way makes it extremely valuable my interests lately have been in using passive collect to identifyenable cne efforts so thats predominantly what the first few topics will be about uf0u0 if there are any topics someone wants to see specifically let know as well if any of the following information is useful please let know and i can put more out part 2 hunting sys admins coming very soon 2 comments leave comment copyright do not reuse this image nsm hide 20121212 1242 pm entry tags admin cne infrastructure quantum target top secret si re l to osa pvey u i hunt sys admins part 2 uf0u0 this post is meant to provide background for why its good to target sys admins in si gi nt if you already know this feel free to skip forward to the next sections ssirel being in sid our overall goal is to produce intelligence to give to decisionmakers how we go about doing that is whenever target uses technology to communicate we collect it analyze it and write reports on it sounds simple enoughexcept for the fact that we have to be targeted in what networks we collect we cant collect everything all the time so if target starts to communicate on network where we are not collecting there is some manual legwork that has to be done to steer the sigint system in their direction this is where i must introduce my loyal friend the sys admin ssirel up front sys admins generally are not my end target my end target is the extremistterrorist or government official that happens to be using the network some admin takes care of sys admins are means to an end for example assume your target is using cdma device on foreign network there may be situations where we passively collect his phone callsms out in the wild but it would be really nice if we had access to the local infrastructure where we could monitor which tower hes connected to at any given point in time or monitor all phone callsdata traffic that his phone generates many times its difficult to directly target infrastructuregenerally well need fair amount of information going into an operation such as topology of the network we are targeting credentials for infrastructure devices situational knowledge such as access lists set up to only allow specific ip addresses to administer certain machines an overall knowledge of how the network is put together and configured ssirel in order to get that who better to target than the person that already has the keys to the kingdom many times as soon as i see target show up on new network one of my first goals is can we get cne access to the admins on that network in order to get access to the infrastructure that target is using yeah that pretty much makes sense but how are you just gonna get cne access on an admin ssirel good question thanks for asking most of the time im going to rely on quantum to get access to their account yeah you could try spam but people have been getting smarter over the last 510 yearsits not as reliable anymore so in order to work our quantummagic on an admin well need some sort of webmailfacebook selector for them you know you could just look up the point of contact in the registry information associated with their ip spacedomain names ssirel yeah you could do that personally i havent had huge amount of luck with it because most of the time i end up running across their official email address thats hosted on their own network thats generally not recipe for success in the quantum world what wed really like is personal webmail or facebook account to target theres couple ways you could try this dumpsterdive for alternate selectors in the big sigint trash can or pull out your wicked googlefu to see if theyve posted on any forums and list both their official and nonofficial emails in signature blockbut what if there was another way to do it ssirel other fun readuseful things to get off of sys admin from my point of view network maps off of their hard drive credentials from text files or from our keyloggerspotato potato full lists of customers along with associated dedicated ip allocations is bonus email with upstream providers detailing how your network is connected to the bigger internetz for example if i see they use certain fiber cables to connect to the world ill go look in ssos collect for their traffic if they use vsats ill go look for their network in fornsats environment pictures of cats in funny poses with amusing captions ssirel but all of this boils down to getting an admins webmailfacebook account in order to quantum it and get cne access to their box next section will detail targeting admins who use telnet 3 comments leave comment top s ecret s i re l to osa pvey copyright do not reuse this image u 1 hunt adm ins that use telnet part 3 s pi hide 20121212 0409 pm copyright do not reuse this image entry tags access list admin cloud cne passive quantum sigint telnet ssirel if target that 1 care about is on network that 1 dont have access to in this post 1 described that i will try to get access to that network by targeting the sys admin in order to target the sys admin its easiest if i know what their personal webmailfacebook username is so that i can target it with quantum the hardest part is identifying that admins personal account to target in the first place now fade off with into dreamland pretend that we had some master list this master list contained tons of networks around the world and the personal accounts of admins for each of those networks and any time you wanted to target new network you could just find the admin associated with it queue his accounts up for quantum get access to his box and proceed to pwn the network wouldnt that be swell ssirel well you can stop dreaming my friends i think its possible at least kinda partially and well get started on this endeavor by chasing down admins that use telnet by this point im hoping youre saying telnet telnet one should still be using telnet that is the correct response however telnet as an administrative tool on the internet is alive and well in fact its so alive and well discoroute is tool specifically designed to suck up and database router configuration files seen in passively collected telnet sessions for the record discoroute is awesome and you should check it out if you have at least one iota of love for sigint so what shall we do with all of these configuration files dude map all the networks ssirel yes that is definitely useful thing to do with all of these router configs and is something that will need to be done but understanding the topology of network isnt necessarily going to get us access to that networkper my previous post i mentioned how getting cne access to an admin is usually golden ticket into the network so this raises question how can we use router configuration file to find the personal webmailfacebook accounts of sys admin ssirel to illustrate this point i randomly picked config for router in kenyathe link is nf so send an email if youd like to look at the config in its entirety for now ill just copypaste the relevant portions this process as with any analysis at its most fundamental level is based on assumptions here are probably some safe assumptions we have router and that router has an admin by the nature of having the config in discoroute the admin uses telnet to log into the router the admin probably doesnt want to let anyone and everyone else log into the router the admin may set up an access control list to only allow his ip addresses to telnet to the router tssirel those seem like relatively safe assumptions to make for the moment now lets see how those manifest in our example kenyan config if youre not familiar with router configs dont worry this will be pretty basic 1 first lets look at the vty readtelnet lines on the router and see if there is an access list associated with them i line vty 0 5 accessclass 11 in password 7 tssirel yup for all of the telnet lines access list 11 is appliedwhich basically means if you want to telnet to this router you have to meet the criteria of that access list oh before i forget password 7s are rofleasy to crack you can google cisco password 7 cracker and get web pages that allow you to copy the password 7 hash and itll break it for freeanyone can figure out the password for this router and pointing out for the lulz the enable password for this router is password 7 hashed as well 2anyway on with the access list 11 access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit access list 11 permit tssirel okay this is relatively selfevident if you want to telnet into this router you have to be coming from one of those ip addresses that are permitted those who are slightly networksaw will also be quick to point out that even if you know the credentials for this router and know which ips are whitelisted you can not just spoof the source ip of packets to try to log into this routerbc youd never see the responses so you actually have to have access to one of these ips to log into this router fair enough mmkay tssirel i want to take quick look back at our assumptions for sec we assumed that an admin would allow himself to telnet but not others so based on the combination of that assumption with the info from the config we can make the following assumption the ip addresses in that access list probably belong to entities that administer that kenyan network tssirel hopefully that sounds fair enough heres the fun partwhy dont we take those ip addresses and look for anyone actively logging into their hotmailyahoofacebooketc accounts from those ip addresses within the recent past with whatever results you get back you now have probable list of personal accounts of administrators for that kenyan network from here if you need cne access to that network just pull those selectors queue them up for quantum and proceed with the pwnage yay throws confetti in the air okay that sounds relatively reasonable but thats still pretty manual process tssirel yeah youre correctbut heres where the cloud actually comes to the rescue yeah i said it crucify meall of the discoroute data is dumped into the gm place cloud all asdf gets dumped into the gm place cloud asdf is the metadata that gets generated for almost every session that we collect in our big bad passive sigint system so all someone would have to do is write cloud analytic that would do the following 1 parse through all of the router configs in discoroute identify every router that has an access list tied to vty telnet line lb look through the access list and pull out all public ip addresses lc put those public ip addresses in list somewhere 2 parse through all the active user events in asdf 2a take the list of public ips that are associated with probable sys admins and use it as our seed list 2b look for all active user login activity from those ip addresses 2c take all accounts that come back and put those into another list tssirel so by combining all of that information you end up with list of public ip addresses that probably belong to sys admins as well as personal accounts that probably belong to those admins all you have to do is put all this info in database somewhere and what you end up with is list of networks as well as personal accounts of probable admins for those networks then as soon as one of those networks becomes target all tao has to do is query the database see if we have any admins preidentified for that network and if we do automatically queue up tasking and gogocne tssirel all of this can be done by tweaking the data that we already have at our fingertips remember our big data problem is that we have too much dataall we have to do is find ways of taking disparate data sets that wouldnt necessarily be interesting by themselves but when you put them together in the right way become simply awesome yeah okay thats cool and all but that relies on sys admins being bad and using telnet dont use telnet and most people that i know dont use telnet it would never be able to identify us tssirel good point this analytic does rely on admins using telnet however i have an idea for how to identify personal accounts of admins that use ssh as well which ill talk about in my next post i hunt admins that use ssh current moodrscheming 7 comments leave comment top s ecret s i re l to osa pvey copyright u hunt adm ins that use ssh part 4 b 5 us hide 20121213 0241pm do not reuse this image entry tags cne quantum router server ssh ssirel welcome back comrade its good to see you again for background i talked in this post about why i target system administrators when i want cne access to network and i talked in this other post about how we can get sys admins personal selectors for targeting based on router configs that we passively collect through telnet sessions this begs the obvious retort yeah but that wouldnt work at all against any sys admin that uses ssh because we would never see the content of the config its encrypted ssirel that is absolutely correct however options exist i still think its possible to identify sys admins personal account sometimes even if they use ssh first off if youre at all unfamiliar with ssh please feel free to check out the resource graciously posted by one of my favorite highside online personas located here ssirel before we get into the methodology lets talk about ssh for minute and some assumptions that were going to make up front caveat im assuming were looking for ssh on port 22 im sure theres ways to find it on nonstandard ports but just for the sake of clarity ill refer to ssh sessions as defined by being on port 22 lets assume that you try to use ssh to connect to some seiver ufouo assuming 1234 actually has ssh listening on port 22 itll go through the 3way tcp handshake and the server will send you back some packets and something like this may pop up warning this is banner for some router owned by some company if youre not authorized to log in to this device disconnect immediately blahblahblah enter username ufouo heres where you enter your usernamewell pretend you type admin and press enter then you get this ufouo okay heres where the rubber meets the road one of two options exist either you have the right password or you dont lets explore what would happen under each of the circumstances first off lets pretend you do not have the right password you try admin for the password and press enter ufouo if youre password guessing youll probably get about 3 tries before the server kills the connection and you have to reconnect and try again however if you do have the right password youll log in you can run your commands to do whatever you want to do and the seiver will spit back the output for all of the commands that you run tssirel i know that sounds ubersimple but heres why it matters think about what all of this would look like if we were to observe this in our passive sigint system we would probably see encrypted traffic between two ips one of the ports would be on port 22 well say thats the seiver side the traffic going to port 22 in the clienttoseiver direction will consist of sending username sending password and sending commands assuming the client successfully logged in for traffic coming from port 22 wellthat depends ssirel if the client does not have the right credentials wed expect the seivertoclient direction to consist of 1 sending the devices banner 2 sending the prompt for username 3 sending the prompt for password 4 sending another prompt for password 5 sending another prompt for password 6 subsequently giving up killing the connection and forcing the client to restart and try again ssirel if the client does have the right credentials we might expect the seivertoclient direction to consist of 1 sending the devices banner 2 sending the prompt for username 3 sending the prompt for password 4 thru sending back the output for whatever commands the client runs ssirel so purely based off of the above assessment we would expect unsuccessful logins to be consistently small as in the number of bytes in the seivertoclient direction however successful logins will be of variable length but probably consistently larger in size in bytes when compared to unsuccessful logins so one assumption that i am suggesting is you can guesstimate whether an ssh session was successful or not purely based off of the size of the session in the servertoclient direction ssirel so imagine that you do some analysis and determine that 1500 bytes is roughly good number to differentiate between successfulunsuccessful ssh login attempts any seiver toclient ssh session below that size is probably an unsuccessful attempt and any seiver toclient ssh session over that size is probably successful attempt what could you do armed with information like that 1 you could create lists of client ip addresses that consistently are unsuccessful in ssh sessions to multiple servers then you could put these in probably password guessersprobably brute forcers list 2 you could also create lists of ip addresses that appear to be successful in having access to other ips ahhhh yeah heres where we can have fun ssirel im sure there are plethora of other things you can do with that sort of data but im really interested in 2 at the moment based purely off of from port 22 session size is greater than 1500 bytes then i can infer that to ip admin from ip serverrouter the admin appears to have successful access to the seiver aaaaand tssirel from here all i have to do is recycle my methodology from last post i can scour all of sigint for sessions that meet the above criteria haivest list of admin ips use that as seed list to go back through all asdf looking for any active user login events within time frame of the ssh session and now i have personal accounts for people that are probably admins to the seiver ip so if the seiver ip is ever in network that i want access to i dont have to decrypt the admins ssh session all i have to do is hope he checked his facebookwebmail within certain timeframe of sshing to the seiver if he did that selector is now tasked for quantum and we wait to get access to his box ssirel one of the reasons why id only look for active user logins within certain timeframe of an ssh session is that i want to make sure to find accounts that are actually associated with the admin and not some other random person who happened to receive that same ip via dhcp the next day or something like that ssirel the previous few posts have gone into some fun ways that we can haivest the power of the sigints to target sys admins of foreign networks my next post will go into an ubersimple way that we can try to detect when people other than the legitimate sys admin have access to router oh yeah find somma that cyber ssirel im sure there are other fun and innovative ways to go about this feel free to share them if you think of any also feel free to take any of the above thoughtsideas and use them for your own purposes like iad maintaining list of ips that we see password guessing in sigint as always if you have any questions or want more info feel free to drop an email or leave comment current moodjuchelicious 21 comments leave comment top secret si re l to osa pvey copyright ssrel hunt people who hack routers part 5 ep 20121214 0108 pm entry tags cne discoroute router sigdev tssirel happy friday my esteemed and valued intelligence community colleagues there has been topic of conversation that has started to rumble beneath the surface of the cyberscene lately its about router hackingfor this post im not talking about your home adsl router im talking about bigger routers such as ciscosjunipershuaweis used by isps for their infrastructure hacking routers has been good business for us and our 5eyes partners for some time now but it is becoming more apparent that other nation states are honing their skillz and joining the scene before i get into it too much lets go over some of the things that someone could do if they hack router you could add credentials allowing yourself to log in anytime you choose you could addchange routing rules you could set up packet capture capabilityimagine running wireshark on an isps infrastructure routerlike local listening post for any credentials being passed over the wire you could weaken any vpn encryption capabilities on the router forcing it to create easily decryptable tunnels you could install dorked version of the operating system with whatever functionality you want prebuilt in tssirel there are plethora of things you could do once you get cne access to routersuffice it to say getting access to router is very good for the actor and very bad for the victim so we would obviously love to know which countriesactors have access to what other routers especially if its our routers then the question comes down to how would you identify the fact that someone has cne access to router tssirel there are handful of ways that you can tell if anyone has access to your router like if you are free to log into your own router you could frequently log in run diagnostic commands pull the ios or more generically the operating system file hash that file and compare that to list of knowngood hashes but how would you find out if someone has cne access to router that you dont own how would you identify it if the chinese had access to router in zimbabwe if all you have is passive network traffic that weve collected in sigint how would you do it the rest of this post relates to nsas methods to detect when countries hack routers we have redacted it to prevent helping those countries improve their ability to hack foreign routers and spy on people undetected